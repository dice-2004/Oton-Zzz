# Oton-Zzz 自動キャリブレーション

## 概要

ユーザーごとの目の開き具合や環境光に合わせて、最適な「まばたき検知閾値」を自動設定します。
音声ガイダンスに従うだけで、誰でも簡単に設定できます。

## 実行方法

### コマンド

```bash
cd /home/hxs_jphacks/Oton-Zzz/code/Oton_Zzz/Raspberry_Pi
python3 main.py --calibrate
```

または、初回セットアップ時にも実行できます：

```bash
python3 main.py --setup
```

### 実行フロー

1. **起動**: 「自動キャリブレーションを起動しました」
2. **ステップ1（30秒）**: 「普通にテレビを見ている状態で測定します」
   - 自然に目を開けて、カメラの方を見てください。
   - 通常のまばたきはOKです。
3. **ステップ2（10秒）**: 「目を閉じた状態で測定します」
   - 音声の合図で目を閉じ、そのまま維持してください。
4. **完了**: 「設定を保存しました」
   - 最適な閾値が計算され、`config/config.json` に保存されます。

## 最適な閾値の計算方法

1. **開眼時の平均スコア** (avg_normal) を測定
2. **閉眼時の平均スコア** (avg_closed) を測定
3. **中間値を計算**: `(avg_normal + avg_closed) / 2`
4. **安全マージンを適用**: 誤検知を防ぐため、少し厳しめに設定します。

この設定は、メインプログラム起動時に自動的に読み込まれます。

## トラブルシューティング

### 音声が聞こえない
スピーカーの音量を確認してください。また、HDMI接続の場合はディスプレイから音が出ている可能性があります。

### 途中で終了したい
**Ctrl+C** を押すと、キャリブレーションを中断して終了します。
